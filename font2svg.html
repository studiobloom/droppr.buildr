<!DOCTYPE html>
<html>
<head>
    <title>SVG Text Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/opentype.js/0.12.0/opentype.min.js"></script>
</head>
<body>
    <h1>SVG Text Generator</h1>
    <form id="uploadForm">
        <input type="file" id="fontFile" accept=".ttf,.otf" required>
        <br>
        <textarea id="textInput" rows="4" cols="50" required></textarea>
        <br>
        <button type="submit">Generate SVG</button>
    </form>
    <div id="svgOutput"></div>
    <a href="#" id="downloadLink" style="display: none;">Download SVG</a>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', function(event) {
            console.log("Form submitted");
            event.preventDefault();
            const fontFile = document.getElementById('fontFile').files[0];
            const textInput = document.getElementById('textInput').value;

            if (!fontFile || !textInput) {
                alert('Please upload a font file and enter some text.');
                return;
            }

            const fileReader = new FileReader();
            fileReader.onload = function() {
                console.log("File loaded");
                opentype.load(fileReader.result, function(err, font) {
                    if (err) {
                        console.error('Could not parse font file: ' + err);
                        return;
                    }

                    console.log("Font file parsed");

                    const fontSize = 50;
                    const pathOptions = {
                        x: 0,
                        y: 60, // Adjust this value to position the text vertically in the canvas
                        fontSize,
                        kerning: true,
                    };

                    // Create path data for your text
                    const path = font.getPath(textInput, pathOptions.x, pathOptions.y, pathOptions.fontSize);

                    // Get the path data for the text
                    const svgPathData = path.toPathData(pathOptions.x, pathOptions.y, pathOptions.fontSize);

                    // Now you can create an SVG element with this path
                    const svgNS = 'http://www.w3.org/2000/svg';
                    const svgElem = document.createElementNS(svgNS, 'svg');
                    const pathElem = document.createElementNS(svgNS, 'path');

                    pathElem.setAttribute('d', svgPathData);
                    svgElem.setAttribute('xmlns', svgNS);
                    svgElem.setAttribute('width', path.getBoundingBox().x2 - path.getBoundingBox().x1);
                    svgElem.setAttribute('height', path.getBoundingBox().y2 - path.getBoundingBox().y1);

                    svgElem.appendChild(pathElem);
                    console.log("SVG element created");

                    // Add the SVG to your page
                    const svgOutputDiv = document.getElementById('svgOutput');
                    svgOutputDiv.innerHTML = '';
                    svgOutputDiv.appendChild(svgElem);
                    console.log("SVG added to the page");

                    // Add a link to download the SVG
                    const downloadLink = document.getElementById('downloadLink');
                    downloadLink.href = "data:image/svg+xml," + encodeURIComponent(svgElem.outerHTML);
                    downloadLink.download = textInput.replace(/\s/g, '_') + ".svg"; // Set the filename based on the text input
                    downloadLink.style.display = "block";
                    console.log("Download link set up");
                });
            };

            console.log("Reading font file");
            fileReader.readAsArrayBuffer(fontFile);
        });
    </script>
</body>
</html>
